<!DOCTYPE HTML>
<html>
<head>
  <title>MAMMA MIA TOURNAMENT</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <link rel="stylesheet" href="assets/css/main.css" />
  <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
  <style>
    .abba-pill {
      background: linear-gradient(135deg,#ff69b4,#ffc0cb);
      color:#fff; padding:8px 14px; border-radius:999px; text-decoration:none; font-weight:700;
      display:inline-block;
    }
    .note { font-size:.95rem; opacity:.85 }
  </style>
</head>
<body class="is-preload">

<div id="wrapper">

  <!-- Header -->
  <header id="header">
    <h2>üé§ü™© MAMMA MIA TOURNAMENT ü™©üé§</h2>
  </header>

  <!-- Nav -->
  <nav id="nav">
    <ul class="links">
      <li><a href="tournaments.html">Tournaments</a></li>
      <li class="active"><a href="#">MAMMA MIA TOURNAMENT</a></li>
    </ul>
  </nav>

  <!-- Main -->
  <div id="main">

    <!-- Intro -->
    <section class="post">
      <header class="major">
        <h1>ü™© MAMMA MIA TOURNAMENT üéæ</h1>
        <p>Division 1: Rating 0.5‚Äì1.5 ‚Ä¢ Division 2: Rating 1.6‚Äì2.5</p>
        <p class="note"><strong>Here we go again!</strong> Gimme! Gimme! Gimme! a winning shot üéæ‚ú®
          Channel your inner Dancing Queen, bring the sparkle, and may the best duo take it all! üíñ</p>
      </header>
      <ul class="actions special">
        <li><a href="#results" class="button primary">Results</a></li>
        <li><a href="#teams" class="button">Teams</a></li>
        <li><a href="#breakdown" class="button">Match Breakdown</a></li>
      </ul>
    </section>

   <!-- ===== STANDINGS (Auto from Google Sheets) ===== -->
<section id="standings" class="post">
  <header class="major"><h2>Standings üèÜ</h2></header>

  <div id="div1-standings">
    <h3>Division 1 (0.5 ‚Äì 1.5)</h3>
    <div id="div1-table">Loading Division 1 Standings‚Ä¶</div>
  </div>

  <div id="div2-standings" style="margin-top:2rem;">
    <h3>Division 2 (1.6 ‚Äì 2.5)</h3>
    <div id="div2-table">Loading Division 2 Standings‚Ä¶</div>
  </div>
</section>


<script>
/* -------- CONFIG: your two sheet URLs (GViz) -------- */
const DIV1_URL = "hhttps://docs.google.com/spreadsheets/d/e/2PACX-1vRVHlKa82Vjdc2qbMt_6N2Gbxjv_tY5zdrtxS8O2BCnr_71DzuMpTNnxjdQr0eCs3le1xzfu_kC7I6q/gviz/tq?tqx=out:json&gid=0";
const DIV2_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRVHlKa82Vjdc2qbMt_6N2Gbxjv_tY5zdrtxS8O2BCnr_71DzuMpTNnxjdQr0eCs3le1xzfu_kC7I6q/gviz/tq?tqx=out:json&gid=1217839661";

/* -------- Helpers -------- */
function showError(targetId, msg, extra) {
  const el = document.getElementById(targetId);
  el.innerHTML = `<div style="background:#fff3f3;border:1px solid #f5c2c7;color:#842029;padding:12px;border-radius:8px;">
    <strong>Standings load error:</strong> ${msg}
    ${extra ? `<pre style="white-space:pre-wrap;margin-top:8px;font-size:.85rem">${extra}</pre>` : ""}
  </div>`;
}

function toMapByLabel(cols) {
  // Build { normalizedLabel: index }
  const map = {};
  cols.forEach((c, i) => {
    const label = (c.label || "").trim().toLowerCase();
    map[label] = i;
  });
  return map;
}

function parseGViz(text) {
  // GViz wraps JSON with )]}'
  const start = text.indexOf("{");
  const end = text.lastIndexOf("}");
  if (start === -1 || end === -1) throw new Error("Invalid GViz payload");
  return JSON.parse(text.substring(start, end + 1));
}

function buildStandingsHTML(teamPoints) {
  const sorted = Object.entries(teamPoints)
    .sort((a, b) => b[1] - a[1] || a[0].localeCompare(b[0])); // tie-break alphabetical (case-insensitive)

  if (sorted.length === 0) {
    return `<div style="opacity:.8">No rows found (check your sheet headers and that at least one Points cell has a number).</div>`;
  }

  let html = "<ol>";
  sorted.slice(0, 12).forEach(([team, pts], i) => {
    const medal = i === 0 ? "ü•á " : i === 1 ? "ü•à " : i === 2 ? "ü•â " : "";
    const strong = i < 3 ? "strong" : "span";
    html += `<li><${strong}>${medal}${team}</${strong}> ‚Äî <${strong}>${Number(pts)||0} pts</${strong}></li>`;
  });
  html += "</ol>";
  return html;
}

function accumulatePoints(json, targetId) {
  const cols = json.table.cols || [];
  const rows = json.table.rows || [];

  // Expect labels: Block | Court | Team A | Team B | Points A | Points B
  const map = toMapByLabel(cols);
  const need = ["block", "court", "team a", "team b", "points a", "points b"];
  const missing = need.filter(k => !(k in map));
  if (missing.length) {
    console.error("Missing expected columns:", { have: cols.map(c=>c.label), missing });
    showError(targetId, "Missing expected column headers in the sheet.",
      "Expected headers (case-insensitive): Block, Court, Team A, Team B, Points A, Points B\n" +
      "Current headers: " + cols.map(c => c.label).join(", ")
    );
    return;
  }

  const iA = map["team a"], iB = map["team b"], iPA = map["points a"], iPB = map["points b"];

  const teamPoints = {};
  rows.forEach(r => {
    const c = r.c || [];
    const teamA = c[iA]?.v?.toString().trim();
    const teamB = c[iB]?.v?.toString().trim();
    const ptsA  = Number(c[iPA]?.v || 0);
    const ptsB  = Number(c[iPB]?.v || 0);
    if (teamA) teamPoints[teamA] = (teamPoints[teamA] || 0) + ptsA;
    if (teamB) teamPoints[teamB] = (teamPoints[teamB] || 0) + ptsB;
  });

  console.table(Object.entries(teamPoints).map(([team, pts]) => ({ team, pts })));
  return teamPoints;
}

/* -------- Fetch path (with detailed logging) -------- */
async function loadStandingsFetch(sheetUrl, targetId) {
  const url = sheetUrl + "&_cb=" + Date.now(); // bust cache
  console.log("[Standings] Fetching:", url);
  const res = await fetch(url, { mode: "cors", credentials: "omit", cache: "no-store" });
  if (!res.ok) {
    throw new Error(`HTTP ${res.status} ${res.statusText}`);
  }
  const text = await res.text();
  console.log("[Standings] Response snippet:", text.slice(0, 200));
  const json = parseGViz(text);
  const teamPoints = accumulatePoints(json, targetId);
  if (!teamPoints) return; // accumulatePoints already reported
  document.getElementById(targetId).innerHTML = buildStandingsHTML(teamPoints);
}

/* -------- JSONP fallback (no CORS issues) -------- */
function loadStandingsJSONP(sheetUrl, targetId) {
  return new Promise((resolve, reject) => {
    const cbName = "gviz_cb_" + Math.random().toString(36).slice(2);
    const url = sheetUrl.replace("tqx=out:json", `tqx=out:json;responseHandler:${cbName}`) + "&_cb=" + Date.now();

    window[cbName] = (json) => {
      try {
        const teamPoints = accumulatePoints(json, targetId);
        if (!teamPoints) { reject(new Error("No data / header mismatch")); return; }
        document.getElementById(targetId).innerHTML = buildStandingsHTML(teamPoints);
        resolve();
      } catch (e) {
        reject(e);
      } finally {
        cleanup();
      }
    };

    const s = document.createElement("script");
    s.src = url;
    s.onerror = (e) => {
      cleanup();
      reject(new Error("JSONP script error"));
    };
    document.body.appendChild(s);

    function cleanup() {
      delete window[cbName];
      if (s.parentNode) s.parentNode.removeChild(s);
    }
  });
}

/* -------- Unified loader: try fetch, then JSONP -------- */
async function loadStandings(sheetUrl, targetId) {
  try {
    await loadStandingsFetch(sheetUrl, targetId);
  } catch (err) {
    console.warn(`[Standings] Fetch failed, falling back to JSONP: ${err && err.message}`);
    try {
      await loadStandingsJSONP(sheetUrl, targetId);
    } catch (err2) {
      console.error("[Standings] JSONP failed:", err2);
      showError(targetId,
        "Could not load from Google Sheets.",
        `Fetch error: ${err && err.message}\nJSONP error: ${err2 && err2.message}\n` +
        `Tips:\n- Make sure the sheet is 'Published to the web' (File ‚Üí Share ‚Üí Publish to web)\n` +
        `- Headers must be EXACTLY: Block | Court | Team A | Team B | Points A | Points B\n` +
        `- Ensure at least one Points cell has a number`
      );
    }
  }
}

/* -------- Kick off both divisions -------- */
loadStandings(DIV1_URL, "div1-table");
loadStandings(DIV2_URL, "div2-table");
</script>




    <!-- ===== TEAMS (UPDATED & ALPHABETICAL) ===== -->
    <section id="teams" class="post">
      <header class="major"><h2>Teams üëØ‚Äç‚ôÄÔ∏è</h2></header>
      <div class="row gtr-200">
        <div class="col-6 col-12-medium">
          <h3>Division 1: Rating 0.5‚Äì1.5</h3>
          <ul class="alt">
            <li>ABBA Angels</li>
            <li>Chiquita's</li>
            <li>Disco Divas</li>
            <li>Drop Shot Divas</li>
            <li>Glitter Gals</li>
            <li>Honey, Honey, hit that ball</li>
            <li>Mama Breena</li>
            <li>Mamma Mia Smashers</li>
            <li>Take A Chance on Us</li>
            <li>The Dynamos</li>
            <li>The Newbies</li>
            <li>The Sister's</li>
          </ul>
        </div>
        <div class="col-6 col-12-medium">
          <h3>Division 2: Rating 1.6‚Äì2.5</h3>
          <ul class="alt">
            <li>ABBA-solutely Smashing</li>
            <li>Hot Shots</li>
            <li>Lay All Your Lobs on Me</li>
            <li>Serve-ivors</li>
            <li>Smashing Queens</li>
            <li>Soft Touch</li>
            <li>Super Troupers</li>
            <li>The Dancing Queens</li>
            <li>The Hitting Huns</li>
            <li>The Spicy Mamma Mias</li>
            <li>Twix</li>
            <li>Waterloo Warriors</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ===== MATCH BREAKDOWN ‚Äì FULL SCHEDULE ADDED ===== -->
    <section id="breakdown" class="post">
      <header class="major"><h2>Match Breakdown üìã</h2></header>

      <!-- LEVEL 1 -->
      <h3>Division 1 (Rating 0.5‚Äì1.5)</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>#</th><th>Court 1</th><th>Court 2</th><th>Court 3</th></tr>
          </thead>
          <tbody id="lvl1-breakdown">
<tr><td>1</td><td>ABBA Angels vs Disco Divas</td><td>Chiquita's vs The Sister's</td><td>Mama Breena vs Drop Shot Divas</td></tr>
<tr><td>2</td><td>Mamma Mia Smashers vs Glitter Gals</td><td>The Newbies vs Take A Chance on Us</td><td>The Dynamos vs Honey, Honey, hit that ball</td></tr>
<tr><td>3</td><td>The Newbies vs Glitter Gals</td><td>The Dynamos vs Mamma Mia Smashers</td><td>Honey, Honey, hit that ball vs Take A Chance on Us</td></tr>
<tr><td>4</td><td>ABBA Angels vs The Sister's</td><td>Chiquita's vs Disco Divas</td><td>Mamma Mia Smashers vs Drop Shot Divas</td></tr>
<tr><td>5</td><td>Mama Breena vs Chiquita's</td><td>Drop Shot Divas vs ABBA Angels</td><td>The Sister's vs Disco Divas</td></tr>
<tr><td>6</td><td>Mama Breena vs Honey, Honey, hit that ball</td><td>The Dynamos vs The Newbies</td><td>Glitter Gals vs Take A Chance on Us</td></tr>
<tr><td>7</td><td>Mama Breena vs Take A Chance on Us</td><td>The Newbies vs Honey, Honey, hit that ball</td><td>The Dynamos vs Glitter Gals</td></tr>
<tr><td>8</td><td>Chiquita's vs Drop Shot Divas</td><td>Mamma Mia Smashers vs ABBA Angels</td><td>Mama Breena vs Disco Divas</td></tr>
<tr><td>9</td><td>Drop Shot Divas vs The Sister's</td><td>Chiquita's vs ABBA Angels</td><td>Mamma Mia Smashers vs Disco Divas</td></tr>
<tr><td>10</td><td>The Newbies vs The Sister's</td><td>Honey, Honey, hit that ball vs Glitter Gals</td><td>The Dynamos vs Take A Chance on Us</td></tr>
<tr><td>11</td><td>The Dynamos vs The Sister's</td><td>Honey, Honey, hit that ball vs Disco Divas</td><td>The Newbies vs ABBA Angels</td></tr>
<tr><td>12</td><td>Chiquita's vs Glitter Gals</td><td>Drop Shot Divas vs Take A Chance on Us</td><td>Mama Breena vs Mamma Mia Smashers</td></tr>
<tr><td>13</td><td>Drop Shot Divas vs Glitter Gals</td><td>Chiquita's vs Take A Chance on Us</td><td>Mamma Mia Smashers vs The Sister's</td></tr>
<tr><td>14</td><td>The Dynamos vs Mama Breena</td><td>The Newbies vs Disco Divas</td><td>Honey, Honey, hit that ball vs ABBA Angels</td></tr>
<tr><td>15</td><td>Mama Breena vs The Newbies</td><td>The Dynamos vs Disco Divas</td><td>Drop Shot Divas vs Honey, Honey, hit that ball</td></tr>
<tr><td>16</td><td>ABBA Angels vs Glitter Gals</td><td>Mamma Mia Smashers vs Take A Chance on Us</td><td>Mama Breena vs The Sister's</td></tr>
<tr><td>17</td><td>Mamma Mia Smashers vs Chiquita's</td><td>ABBA Angels vs Take A Chance on Us</td><td>Glitter Gals vs The Sister's</td></tr>
<tr><td>18</td><td>The Dynamos vs Chiquita's</td><td>The Newbies vs Drop Shot Divas</td><td>Disco Divas vs Take A Chance on Us</td></tr>
<tr><td>19</td><td>Chiquita's vs Honey, Honey, hit that ball</td><td>The Dynamos vs Drop Shot Divas</td><td>Glitter Gals vs Disco Divas</td></tr>
<tr><td>20</td><td>Mamma Mia Smashers vs Honey, Honey, hit that ball</td><td>Mama Breena vs ABBA Angels</td><td>The Newbies vs Chiquita's</td></tr>
<tr><td>21</td><td>Honey, Honey, hit that ball vs The Sister's</td><td>Mamma Mia Smashers vs The Newbies</td><td>The Dynamos vs ABBA Angels</td></tr>
<tr><td>22</td><td>The Sister's vs Take A Chance on Us</td><td>Mama Breena vs Glitter Gals</td><td>Drop Shot Divas vs Disco Divas</td></tr>
          </tbody>
        </table>
      </div>

      <!-- LEVEL 2 -->
      <h3>Division 2 (Rating 1.6‚Äì2.5)</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr><th>#</th><th>Court 4</th><th>Court 5</th><th>Court 6</th></tr>
          </thead>
          <tbody id="lvl2-breakdown">
<tr><td>1</td><td>Lay All Your Lobs on Me vs Serve-ivors</td><td>Soft Touch vs Hot Shots</td><td>The Hitting Huns vs Twix</td></tr>
<tr><td>2</td><td>ABBA-solutely Smashing vs Waterloo Warriors</td><td>Super Troupers vs The Dancing Queens</td><td>Smashing Queens vs The Spicy Mamma Mias</td></tr>
<tr><td>3</td><td>Waterloo Warriors vs The Dancing Queens</td><td>Super Troupers vs The Spicy Mamma Mias</td><td>ABBA-solutely Smashing vs Smashing Queens</td></tr>
<tr><td>4</td><td>The Hitting Huns vs Hot Shots</td><td>Twix vs Serve-ivors</td><td>Soft Touch vs Lay All Your Lobs on Me</td></tr>
<tr><td>5</td><td>Lay All Your Lobs on Me vs Hot Shots</td><td>Soft Touch vs Serve-ivors</td><td>Smashing Queens vs The Hitting Huns</td></tr>
<tr><td>6</td><td>Twix vs The Dancing Queens</td><td>Waterloo Warriors vs The Spicy Mamma Mias</td><td>ABBA-solutely Smashing vs Super Troupers</td></tr>
<tr><td>7</td><td>Twix vs Waterloo Warriors</td><td>The Spicy Mamma Mias vs The Dancing Queens</td><td>Hot Shots vs Super Troupers</td></tr>
<tr><td>8</td><td>ABBA-solutely Smashing vs Soft Touch</td><td>The Hitting Huns vs Serve-ivors</td><td>Smashing Queens vs Lay All Your Lobs on Me</td></tr>
<tr><td>9</td><td>ABBA-solutely Smashing vs Serve-ivors</td><td>The Hitting Huns vs Lay All Your Lobs on Me</td><td>Soft Touch vs Smashing Queens</td></tr>
<tr><td>10</td><td>Twix vs The Spicy Mamma Mias</td><td>Waterloo Warriors vs Super Troupers</td><td>Hot Shots vs The Dancing Queens</td></tr>
<tr><td>11</td><td>Twix vs Super Troupers</td><td>Hot Shots vs Waterloo Warriors</td><td>ABBA-solutely Smashing vs The Dancing Queens</td></tr>
<tr><td>12</td><td>Soft Touch vs The Spicy Mamma Mias</td><td>Smashing Queens vs Serve-ivors</td><td>Twix vs Lay All Your Lobs on Me</td></tr>
<tr><td>13</td><td>The Hitting Huns vs The Spicy Mamma Mias</td><td>Soft Touch vs The Dancing Queens</td><td>Serve-ivors vs Waterloo Warriors</td></tr>
<tr><td>14</td><td>The Hitting Huns vs Super Troupers</td><td>Smashing Queens vs Hot Shots</td><td>ABBA-solutely Smashing vs Lay All Your Lobs on Me</td></tr>
<tr><td>15</td><td>ABBA-solutely Smashing vs The Hitting Huns</td><td>Lay All Your Lobs on Me vs Super Troupers</td><td>Hot Shots vs The Spicy Mamma Mias</td></tr>
<tr><td>16</td><td>Smashing Queens vs The Dancing Queens</td><td>Soft Touch vs Waterloo Warriors</td><td>Serve-ivors vs Super Troupers</td></tr>
<tr><td>17</td><td>Smashing Queens vs Twix</td><td>Serve-ivors vs The Dancing Queens</td><td>Soft Touch vs The Hitting Huns</td></tr>
<tr><td>18</td><td>Twix vs Hot Shots</td><td>Lay All Your Lobs on Me vs Waterloo Warriors</td><td>ABBA-solutely Smashing vs The Spicy Mamma Mias</td></tr>
<tr><td>19</td><td>ABBA-solutely Smashing vs Twix</td><td>Lay All Your Lobs on Me vs The Spicy Mamma Mias</td><td>Smashing Queens vs Waterloo Warriors</td></tr>
<tr><td>20</td><td>Serve-ivors vs Hot Shots</td><td>The Hitting Huns vs The Dancing Queens</td><td>Soft Touch vs Super Troupers</td></tr>
<tr><td>21</td><td>ABBA-solutely Smashing vs Hot Shots</td><td>Soft Touch vs Twix</td><td>The Hitting Huns vs Waterloo Warriors</td></tr>
<tr><td>22</td><td>Lay All Your Lobs on Me vs The Dancing Queens</td><td>Serve-ivors vs The Spicy Mamma Mias</td><td>Smashing Queens vs Super Troupers</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </div><!-- /#main -->
</div><!-- /#wrapper -->

<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/jquery.scrollex.min.js"></script>
<script src="assets/js/jquery.scrolly.min.js"></script>
<script src="assets/js/browser.min.js"></script>
<script src="assets/js/breakpoints.min.js"></script>
<script src="assets/js/util.js"></script>
<script src="assets/js/main.js"></script>

</body>
</html>
